<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© ØªØªØ¨Ø¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù - Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¨</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Light theme (restored to original look) */
      --ink: #0b2545;
      --accent: #19b6c9;
      --muted: #6a7b8c;
      --card: #ffffff;
      --surface: #f6fbff;
      --chip-open: #0f9d58;
      --chip-closed: #c0392b;
      --bg: radial-gradient(circle at 20% 20%, #e7f7ff, #d7e6f3 45%, #c7d7ea 75%);
      --table-header: var(--card);
      --table-header-text: var(--muted);
    }
    :root.dark {
      /* Dark theme (distinct, without altering light) */
      --ink: #e4ecf5;
      --accent: #3fd0ff;
      --muted: #9eb4cb;
      --card: #142235;
      --surface: #0c1928;
      --chip-open: #1bd585;
      --chip-closed: #ff7b7b;
      --bg: radial-gradient(circle at 20% 20%, #0c1622, #0b1a2f 50%, #0c1b36 100%);
      --table-header: #0b253d;
      --table-header-text: #e9f2fb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Cairo', 'Space Grotesk', system-ui, sans-serif;
      font-size: 18px;
      background: var(--bg);
      color: var(--ink);
      line-height: 1.6;
    }
    header {
      padding: 40px 16px 18px;
      text-align: center;
    }
    .title {
      margin: 0;
      font-size: 32px;
      letter-spacing: -0.02em;
    }
    .subtitle {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 16px;
    }
    .shell {
      max-width: 1200px;
      margin: 0 auto 48px;
      padding: 0 16px 24px;
    }
    .panel {
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 24px 60px rgba(6, 57, 97, 0.12);
      padding: 20px;
      border: 1px solid rgba(11, 37, 69, 0.07);
    }
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    label {
      font-weight: 600;
      color: var(--muted);
      font-size: 13px;
    }
    input, select {
      padding: 10px 12px;
      height: 44px;
      line-height: 22px;
      border-radius: 10px;
      border: 1px solid rgba(11, 37, 69, 0.18);
      background: #f8fbff;
      font-family: 'Cairo', sans-serif;
      font-size: 16px;
    }
    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='14' height='9' viewBox='0 0 14 9' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l6 6 6-6' stroke='%236a7b8c' stroke-width='2' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: calc(100% - 10px) center;
      padding-right: 32px;
    }
    input:focus, select:focus {
      outline: 2px solid rgba(25, 182, 201, 0.35);
      border-color: transparent;
      background: white;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 15px;
    }
    thead {
      background: var(--table-header);
      color: var(--table-header-text);
    }
    th, td {
      padding: 14px 10px;
      text-align: right;
      border-bottom: 1px solid rgba(11, 37, 69, 0.07);
    }
    th {
      font-weight: 700;
      color: var(--muted);
      font-size: 13px;
    }
    .title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .ios-arrow {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.08);
      background: var(--card);
      cursor: pointer;
      flex-shrink: 0;
    }
    .ios-arrow:hover {
      border-color: var(--accent);
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    }
    tbody tr {
      background: var(--surface);
      transition: background 0.2s ease, transform 0.08s ease;
    }
    tbody tr:nth-child(2n) {
      background: var(--surface);
    }
    tbody tr:hover {
      background: color-mix(in srgb, var(--surface) 80%, var(--accent) 20%);
      transform: translateY(-1px);
    }
    .status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      color: white;
      font-weight: 700;
      font-size: 12px;
    }
    .status.open { background: var(--chip-open); }
    .status.closed { background: var(--chip-closed); }
    .status.unknown { background: #999; }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 10px;
      background: var(--card);
      border: 1px solid rgba(11, 37, 69, 0.05);
      color: var(--ink);
      font-weight: 600;
    }
    .links a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 700;
    }
    .links a:hover { text-decoration: underline; }
    .meta {
      color: var(--muted);
      font-size: 12px;
      margin-top: 8px;
    }
    .clickable {
      cursor: pointer;
      transition: transform 0.08s ease;
    }
    .clickable:hover {
      transform: scale(1.02);
    }
    .header-sort {
      cursor: pointer;
      position: relative;
      transition: color 0.15s ease, background 0.15s ease;
    }
    .pill-button {
      padding: 8px 14px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.06);
      background: var(--card);
      color: var(--ink);
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .pill-button:hover {
      border-color: var(--accent);
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    }
    .header-sort:hover {
      color: var(--accent);
      background: rgba(25, 182, 201, 0.08);
    }
    @media (max-width: 800px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead { display: none; }
      tr { margin-bottom: 14px; background: #f9fcff; border-radius: 10px; padding: 8px; }
      td { border: none; padding: 6px 4px; }
      td::before {
        content: attr(data-label);
        display: block;
        font-weight: 700;
        color: var(--muted);
        margin-bottom: 4px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 class="title">Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¹Ù„Ù†Ø©</h1>
    <p class="subtitle">ØªØ¬Ù…ÙŠØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† applyjobs.spac.gov.jo Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© | Auto-collected listings from applyjobs.spac.gov.jo with search & filters</p>
    <p class="subtitle" style="font-size:13px;color:var(--muted);">ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠÙ‹Ø§ (Ø­ÙˆØ§Ù„ÙŠ 08:00 Ùˆ 17:00 Ø¨ØªÙˆÙ‚ÙŠØª Ø¹Ù…Ù‘Ø§Ù†ØŒ Ø§Ù„Ø£Ø±Ø¯Ù†)</p>
    <p class="subtitle" id="lastUpdated" style="font-size:13px;color:var(--muted);"></p>
    <button id="themeToggle" class="pill-button" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹" style="margin-top:10px;">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…Ø· (ÙØ§ØªØ­/Ø¯Ø§ÙƒÙ†)</button>
  </header>

  <div class="shell">
    <div class="panel">
      <div class="controls">
        <div class="field">
          <label for="search">Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„ÙˆØµÙ</label>
          <input id="search" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ù‡Ù†Ø¯Ø³ØŒ ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ØŒ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">
        </div>
        <div class="field">
          <label for="titleSearch">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ø³Ù… Ø§Ù„ÙˆØ¸ÙŠÙØ©</label>
          <select id="titleSearch">
            <option value="all">Ø§Ù„ÙƒÙ„</option>
          </select>
        </div>
        <div class="field">
          <label for="status">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</label>
          <select id="status">
            <option value="all">Ø§Ù„ÙƒÙ„</option>
            <option value="open">Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù†</option>
            <option value="closed">Ù…Ù†ØªÙ‡ÙŠ</option>
          </select>
        </div>
        <div class="field">
          <label for="location">Ø§Ù„Ù…ÙˆÙ‚Ø¹/Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
          <select id="location">
            <option value="all">Ø§Ù„ÙƒÙ„</option>
          </select>
        </div>
        <div class="field">
          <label for="experienceFilter">Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø©</label>
          <select id="experienceFilter">
            <option value="all">Ø§Ù„ÙƒÙ„</option>
          </select>
        </div>
        <div class="field">
          <label for="organization">Ø§Ù„Ø¬Ù‡Ø©</label>
          <select id="organization">
            <option value="all">Ø§Ù„ÙƒÙ„</option>
          </select>
        </div>
      </div>

      <div class="meta" id="meta"></div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
            <th class="header-sort" data-key="title" title="Ø§Ø¶ØºØ· Ù„Ù„ÙØ±Ø² Ø£Ùˆ Ø§Ù„ØªØ¬Ù…ÙŠØ¹">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th>
            <th class="header-sort" data-key="status">Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th class="header-sort" data-key="location">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
            <th class="header-sort" data-key="end_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</th>
            <th class="header-sort" data-key="experience_text">Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø©</th>
            <th class="header-sort" data-key="salary">Ø§Ù„Ø±Ø§ØªØ¨</th>
            <th class="header-sort" data-key="vacancies">Ø´ÙˆØ§ØºØ±</th>
            <th>Ø±ÙˆØ§Ø¨Ø·</th>
          </tr>
        </thead>
        <tbody id="jobsBody"></tbody>
      </table>
    </div>
    </div>
  </div>

  <script>
    const jobsBody = document.getElementById('jobsBody');
    const searchInput = document.getElementById('search');
    const titleSearchInput = document.getElementById('titleSearch');
    const statusSelect = document.getElementById('status');
    const locationInput = document.getElementById('location');
    const experienceFilter = document.getElementById('experienceFilter');
    const organizationInput = document.getElementById('organization');
    const meta = document.getElementById('meta');
    const themeToggle = document.getElementById('themeToggle');
    const lastUpdated = document.getElementById('lastUpdated');

    let jobs = [];
    let currentSort = { key: null, direction: 1 };
    const isIosSafari = (() => {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
      const isChromeIOS = /CriOS/i.test(ua);
      return isIOS && isSafari && !isChromeIOS;
    })();

    function statusLabel(status) {
      const cls = status === 'open' ? 'open' : status === 'closed' ? 'closed' : 'unknown';
      const text = status === 'open' ? 'Ù…ØªØ§Ø­' : status === 'closed' ? 'Ù…Ù†ØªÙ‡ÙŠ' : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
      return `<span class="status ${cls}">${text}</span>`;
    }

    function experienceComparator(a, b) {
      const valA = normalizeExperienceValue(a);
      const valB = normalizeExperienceValue(b);
      const numA = Number(valA);
      const numB = Number(valB);
      const aIsNum = !Number.isNaN(numA);
      const bIsNum = !Number.isNaN(numB);
      if (valA === '--' && valB !== '--') return -1;
      if (valB === '--' && valA !== '--') return 1;
      if (aIsNum && bIsNum) return numA - numB;
      if (aIsNum && !bIsNum) return -1;
      if (!aIsNum && bIsNum) return 1;
      return (valA || '').toString().localeCompare((valB || '').toString(), 'ar');
    }

    function normalizeExperienceValue(job) {
      const raw = job.experience_raw || job.experience_text || job.experience_years || '';
      if (!raw) return '--';
      const match = String(raw).match(/(\d+)/);
      if (match && match[1]) return match[1];
      return '--';
    }

    function sortData(list) {
      if (!currentSort.key) return list;
      const sorted = [...list];
      sorted.sort((a, b) => {
        let result = 0;
        switch (currentSort.key) {
          case 'end_date':
            result = (a.end_date || '').localeCompare(b.end_date || '');
            break;
          case 'salary':
            result = Number(a.salary || 0) - Number(b.salary || 0);
            break;
          case 'vacancies':
            result = (a.vacancies ?? '').toString().localeCompare((b.vacancies ?? '').toString(), 'ar', { numeric: true });
            break;
          case 'experience_text':
            result = experienceComparator(a, b);
            break;
          case 'status':
          case 'location':
          case 'title':
            result = (a[currentSort.key] || '').localeCompare(b[currentSort.key] || '', 'ar');
            break;
          default:
            result = 0;
        }
        return currentSort.direction * result;
      });
      return sorted;
    }

    function render(filtered) {
      const list = sortData(filtered);
      jobsBody.innerHTML = list.map(job => {
        const attachments = [];
        if (job.announcement_pdf) attachments.push(`<a href="${job.announcement_pdf}" target="_blank">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</a>`);
        if (job.description_pdf) attachments.push(`<a href="${job.description_pdf}" target="_blank">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙˆØµÙ</a>`);
        attachments.push(`<a href="${job.detail_url}" target="_blank">ØªÙØ§ØµÙŠÙ„</a>`);

        const endDate = job.end_date || 'â€”';
        const location = job.location || 'â€”';
        const vacancies = job.vacancies ?? 'â€”';
        const rawExp = (job.experience_raw || job.experience_text || job.experience_years || '').toString().trim();
        const expValue = normalizeExperienceValue(job);
        const expDisplay = expValue || (rawExp || '--');
        const expTitle = `Ø®Ø¨Ø±Ø© ÙÙ†ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ© : ${rawExp || '--'}`;
        const salaryDisplay = job.salary != null ? job.salary : 'â€”';

        const titleBlock = isIosSafari
          ? `<div class="title-row"><div style="font-weight:700">${job.title}</div><button class="ios-arrow" type="button" data-url="${job.detail_url}" aria-label="ÙØªØ­ Ø§Ù„ØªÙØ§ØµÙŠÙ„"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 16L16 8" stroke="#19b6c9" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 8H16V15" stroke="#19b6c9" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg></button></div>`
          : `<div style="font-weight:700">${job.title}</div>`;

        return `
          <tr data-url="${job.detail_url}">
            <td data-label="Ø§Ù„Ù…Ø³Ù…Ù‰" class="clickable title-cell">
              ${titleBlock}
              <div class="meta organization clickable" data-org="${job.organization || ''}">${job.organization || ''}</div>
              <div class="meta vacancy clickable" data-vac="${job.vacancy_spec || ''}">${job.vacancy_spec || ''}</div>
            </td>
            <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©" class="clickable status-cell" data-status="${job.status}">${statusLabel(job.status)}</td>
            <td data-label="Ø§Ù„Ù…ÙˆÙ‚Ø¹" class="clickable location-cell" data-location="${location}"><span class="badge">ğŸ“ ${location}</span></td>
            <td data-label="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØºÙ„Ø§Ù‚">${endDate}</td>
            <td data-label="Ø§Ù„Ø®Ø¨Ø±Ø©" class="clickable experience-cell" data-exp="${expValue}" title="${expTitle}">${expDisplay}</td>
            <td data-label="Ø§Ù„Ø±Ø§ØªØ¨">${salaryDisplay}</td>
            <td data-label="Ø§Ù„Ø´ÙˆØ§ØºØ±">${vacancies}</td>
            <td data-label="Ø±ÙˆØ§Ø¨Ø·" class="links">${attachments.join(' â€¢ ')}</td>
          </tr>
        `;
      }).join('');

      meta.textContent = `Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶: ${filtered.length} ÙˆØ¸ÙŠÙØ© | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${jobsMeta.scraped_at || 'ØºÙŠØ± Ù…ØªØ§Ø­'}`;
    }

    function filterJobs() {
      const term = searchInput.value.trim().toLowerCase();
      const titleTerm = titleSearchInput.value.trim().toLowerCase();
      const status = statusSelect.value;
      const location = locationInput.value.trim().toLowerCase();
      const experienceVal = experienceFilter.value;
      const org = organizationInput.value.trim().toLowerCase();

      const filtered = jobs.filter(job => {
        const haystack = [
          job.title,
          job.organization,
          job.vacancy_spec,
          job.requirements,
          job.experience_text || job.experience_years || job.experience_raw,
          normalizeExperienceValue(job),
          job.qualification
        ].join(' ').toLowerCase();

        const matchesTerm = !term || haystack.includes(term);
        const matchesTitle = titleTerm === 'all' || (job.title || '').toLowerCase().includes(titleTerm);
        const matchesStatus = status === 'all' || job.status === status;
        const matchesLocation = location === 'all' || (job.location || '').toLowerCase().includes(location);
        const matchesExperience = experienceVal === 'all' || normalizeExperienceValue(job) === experienceVal;
        const matchesOrg = org === 'all' || (job.organization || '').toLowerCase().includes(org);

        return matchesTerm && matchesTitle && matchesStatus && matchesLocation && matchesExperience && matchesOrg;
      });

      render(filtered);
    }

    let jobsMeta = {};

    fetch('data/jobs.json')
      .then(res => res.json())
      .then(data => {
        jobs = (data.jobs || []).map(j => ({
          ...j,
          experience_text: j.experience_text || (j.experience_years != null ? String(j.experience_years) : ''),
          experience_raw: j.experience_raw || j.experience_text
        }));
        jobsMeta = data;
        // sort by end date descending (soonest first)
        jobs.sort((a, b) => (a.end_date || '').localeCompare(b.end_date || ''));
        populateDatalists(jobs);
        render(jobs);
        attachClickFilters();
        initTheme();
        updateLastUpdated();
      })
      .catch(err => {
        meta.textContent = 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ.';
        console.error(err);
      });

    [searchInput, titleSearchInput, statusSelect, locationInput, experienceFilter, organizationInput].forEach(el => {
      el.addEventListener('input', filterJobs);
      el.addEventListener('change', filterJobs);
    });

    function initTheme() {
      const root = document.documentElement;
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') root.classList.add('dark');
      updateToggleLabel();
      themeToggle.addEventListener('click', () => {
        root.classList.toggle('dark');
        const mode = root.classList.contains('dark') ? 'dark' : 'light';
        localStorage.setItem('theme', mode);
        updateToggleLabel();
      });
    }

    function updateToggleLabel() {
      const mode = document.documentElement.classList.contains('dark') ? 'Ø¯Ø§ÙƒÙ†' : 'ÙØ§ØªØ­';
      themeToggle.textContent = `ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…Ø· (${mode === 'Ø¯Ø§ÙƒÙ†' ? 'Ø¯Ø§ÙƒÙ†/ÙØ§ØªØ­' : 'ÙØ§ØªØ­/Ø¯Ø§ÙƒÙ†'})`;
    }

    function populateDatalists(list) {
      const uniqueLocations = Array.from(new Set(list.map(j => j.location || '').filter(Boolean))).sort();
      const uniqueOrgs = Array.from(new Set(list.map(j => j.organization || '').filter(Boolean))).sort();
      const uniqueTitles = Array.from(new Set(list.map(j => j.title || '').filter(Boolean))).sort();
      const uniqueExp = Array.from(new Set(list.map(j => normalizeExperienceValue(j)).filter(Boolean))).sort((a, b) => {
        if (a === '--') return 1;
        if (b === '--') return -1;
        return Number(a) - Number(b);
      });

      locationInput.innerHTML = `<option value="all">Ø§Ù„ÙƒÙ„</option>` + uniqueLocations.map(v => `<option value="${v}">${v}</option>`).join('');
      organizationInput.innerHTML = `<option value="all">Ø§Ù„ÙƒÙ„</option>` + uniqueOrgs.map(v => `<option value="${v}">${v}</option>`).join('');
      titleSearchInput.innerHTML = `<option value="all">Ø§Ù„ÙƒÙ„</option>` + uniqueTitles.map(v => `<option value="${v}">${v}</option>`).join('');
      experienceFilter.innerHTML = `<option value="all">Ø§Ù„ÙƒÙ„</option>` + uniqueExp.map(v => `<option value="${v}">${v === '--' ? 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' : v}</option>`).join('');
    }

    function updateLastUpdated() {
      if (!jobsMeta.scraped_at) {
        lastUpdated.textContent = 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ØºÙŠØ± Ù…ØªØ§Ø­';
        return;
      }
      const dt = new Date(jobsMeta.scraped_at);
      const fmt = dt.toLocaleString('en-GB', {
        timeZone: 'Asia/Amman',
        hour12: false,
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
      lastUpdated.textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${fmt} (Ø¨ØªÙˆÙ‚ÙŠØª Ø¹Ù…Ù‘Ø§Ù†ØŒ Ø§Ù„Ø£Ø±Ø¯Ù†)`;
    }

    function attachClickFilters() {
      // Header sorting/grouping
      document.querySelectorAll('.header-sort').forEach(th => {
        th.addEventListener('click', () => {
          const key = th.dataset.key;
          if (currentSort.key === key) {
            currentSort.direction *= -1;
          } else {
            currentSort = { key, direction: 1 };
          }
          filterJobs();
        });
      });

      jobsBody.addEventListener('click', (e) => {
        const arrow = e.target.closest('.ios-arrow');
        if (arrow) {
          e.preventDefault();
          e.stopPropagation();
          const url = arrow.dataset.url;
          if (url) window.open(url, '_blank');
          return;
        }

        const cell = e.target.closest('.status-cell, .location-cell, .organization, .vacancy, .experience-cell');
        const row = e.target.closest('tr[data-url]');
        if (!cell && row && e.target.tagName !== 'A') {
          window.open(row.dataset.url, '_blank');
          return;
        }

        if (cell?.classList.contains('status-cell')) {
          const status = cell.dataset.status;
          if (status) {
            statusSelect.value = status === 'unknown' ? 'all' : status;
            filterJobs();
          }
        } else if (cell?.classList.contains('location-cell')) {
          const loc = cell.dataset.location || '';
          locationInput.value = loc;
          filterJobs();
        } else if (cell?.classList.contains('organization')) {
          const org = cell.dataset.org || '';
          organizationInput.value = org;
          filterJobs();
        }
      });
    }
  </script>
</body>
</html>
